import { TimepickerUtil } from './timepicker.util';
export class Duration {
    constructor(hour, minute, second) {
        this.hour = hour;
        this.minute = minute;
        this.second = second;
    }
    static parseTimes(times) {
        let hour, minute, second;
        if (times.length > 1) {
            hour = parseInt(times[0], 10);
            minute = parseInt(times[1], 10);
            if (TimepickerUtil.isRealNumber(hour) && TimepickerUtil.isRealNumber(minute)) {
                if (times.length > 2) {
                    second = parseInt(times[2], 10);
                }
                if (!TimepickerUtil.isRealNumber(second)) {
                    second = 0;
                }
                if (hour < 0) {
                    hour = 0;
                }
                if (minute < 0) {
                    minute = 0;
                }
                if (second < 0) {
                    second = 0;
                }
                hour %= 24;
                minute %= 60;
                second %= 60;
                if (hour < 12 && times.length > 2 && times[2].toLowerCase().includes('pm')) {
                    hour += 12;
                }
                return new Duration(hour, minute, second);
            }
        }
        return null;
    }
    static valueOf(hour, minute, second) {
        return new Duration(hour, minute, second);
    }
    static zero() {
        return new Duration(0, 0, 0);
    }
    static fromMillis(count) {
        if (count < 0) {
            return null;
        }
        return new Duration(Math.floor(count / Duration.matrix.hours.milliseconds) % Duration.matrix.days.hours, Math.floor(count / Duration.matrix.minutes.milliseconds) % Duration.matrix.hours.minutes, Math.floor(count / Duration.matrix.seconds.milliseconds) % Duration.matrix.minutes.seconds);
    }
    static fromString(value, separator) {
        if (typeof value === 'string') {
            let time;
            if (typeof separator === 'string') {
                time = Duration.parseTimes(value.split(separator));
                if (time) {
                    return time;
                }
            }
            time = Duration.parseTimes(value.split(':'));
            if (time) {
                return time;
            }
            time = Duration.parseTimes(value.split('-'));
            if (time) {
                return time;
            }
            time = Duration.parseTimes(value.split('.'));
            if (time) {
                return time;
            }
            time = Duration.parseTimes(value.split(';'));
            if (time) {
                return time;
            }
            time = Duration.parseTimes(value.split(','));
            if (time) {
                return time;
            }
        }
        return null;
    }
    static fromDate(value) {
        if (value instanceof Date) {
            return new Duration(value.getHours(), value.getMinutes(), value.getSeconds());
        }
        return null;
    }
    static now(second = true) {
        const now = new Date();
        return new Duration(now.getHours(), now.getMinutes(), second ? now.getSeconds() : 0);
    }
    clone() {
        return new Duration(this.hour, this.minute, this.second);
    }
    getValue(type) {
        if (['hour', 'minute', 'second'].includes(type)) {
            return this[type];
        }
        return null;
    }
    setValue(type, value) {
        if (['hour', 'minute', 'second'].includes(type)) {
            this[type] = value;
        }
        return this;
    }
    setNew(type, value) {
        const result = new Duration(this.hour, this.minute, this.second);
        if (['hour', 'minute', 'second'].includes(type)) {
            result[type] = value;
        }
        return result;
    }
    format(format) {
        if (format) {
            const replace = (f, v, r) => {
                let match;
                while (true) {
                    match = r.match(f);
                    if (match && typeof match[0] === 'string') {
                        r = r.replace(match[0], String(v).padStart(match[0].length, '0'));
                    }
                    else {
                        break;
                    }
                }
                return r;
            };
            let result = format;
            result = replace(/h+/i, this.hour, result);
            result = replace(/m+/i, this.minute, result);
            result = replace(/s+/i, this.second, result);
            return result;
        }
        else {
            return `${String(this.hour).padStart(2, '0')}:${String(this.minute).padStart(2, '0')}:${String(this.second).padStart(2, '0')}`;
        }
    }
    milliseconds() {
        return this.hour * Duration.matrix.hours.milliseconds +
            this.minute * Duration.matrix.minutes.milliseconds +
            this.second * Duration.matrix.seconds.milliseconds;
    }
    setToDate(value) {
        value.setHours(this.hour);
        value.setMinutes(this.minute);
        value.setSeconds(this.second);
        value.setMilliseconds(0);
        return value;
    }
    equals(value) {
        return value != null && this.hour === value.hour && this.minute === value.minute && this.second === value.second;
    }
}
Duration.matrix = {
    days: { hours: 24, minutes: 1440, seconds: 86400, milliseconds: 86400000 },
    hours: { minutes: 60, seconds: 3600, milliseconds: 3600000 },
    minutes: { seconds: 60, milliseconds: 60000 },
    seconds: { milliseconds: 1000 }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXBpY2tlci5tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiJEOi9Eb2N1bWVudC9MaWJyYXJ5L0FuZ3VsYXIvbWF0ZXJpYWwtZXh0cmEvcHJvamVjdHMvbWF0ZXJpYWwvdGltZXBpY2tlci9zcmMvIiwic291cmNlcyI6WyJsaWIvdGltZXBpY2tlci5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFXakQsTUFBTSxPQUFPLFFBQVE7SUFZakIsWUFBWSxJQUFZLEVBQUUsTUFBYyxFQUFFLE1BQWM7UUFDcEQsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDekIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBZTtRQUNyQyxJQUFJLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDO1FBQ3pCLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEIsSUFBSSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDOUIsTUFBTSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDaEMsSUFBSSxjQUFjLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLGNBQWMsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzFFLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ2xCLE1BQU0sR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2lCQUNuQztnQkFDRCxJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMs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Q0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDO0lBQzNELENBQUM7SUFFRCxTQUFTLENBQUMsS0FBVztRQUNqQixLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQixLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QixLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QixLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBZTtRQUNsQixPQUFPLEtBQUssSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLEtBQUssQ0FBQyxNQUFNLENBQUM7SUFDckgsQ0FBQzs7QUF0TE0sZUFBTSxHQUFRO0lBQ2pCLElBQUksRUFBRSxFQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUM7SUFDeEUsS0FBSyxFQUFFLEVBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUM7SUFDMUQsT0FBTyxFQUFFLEVBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFDO0lBQzNDLE9BQU8sRUFBRSxFQUFDLFlBQVksRUFBRSxJQUFJLEVBQUM7Q0FDaEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VGltZXBpY2tlclV0aWx9IGZyb20gJy4vdGltZXBpY2tlci51dGlsJztcclxuXHJcbmV4cG9ydCBkZWNsYXJlIHR5cGUgQ2xvY2tUeXBlID0gJ2hvdXInIHwgJ21pbnV0ZScgfCAnc2Vjb25kJztcclxuXHJcbmV4cG9ydCBkZWNsYXJlIHR5cGUgQ2xpY2tUeXBlID0gJ29rJyB8ICdjYW5jZWwnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDbG9ja0NoYW5nZSB7XHJcbiAgICB0eXBlOiBDbG9ja1R5cGU7XHJcbiAgICB2YWx1ZTogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRHVyYXRpb24ge1xyXG4gICAgc3RhdGljIG1hdHJpeDogYW55ID0ge1xyXG4gICAgICAgIGRheXM6IHtob3VyczogMjQsIG1pbnV0ZXM6IDE0NDAsIHNlY29uZHM6IDg2NDAwLCBtaWxsaXNlY29uZHM6IDg2NDAwMDAwfSxcclxuICAgICAgICBob3Vyczoge21pbnV0ZXM6IDYwLCBzZWNvbmRzOiAzNjAwLCBtaWxsaXNlY29uZHM6IDM2MDAwMDB9LFxyXG4gICAgICAgIG1pbnV0ZXM6IHtzZWNvbmRzOiA2MCwgbWlsbGlzZWNvbmRzOiA2MDAwMH0sXHJcbiAgICAgICAgc2Vjb25kczoge21pbGxpc2Vjb25kczogMTAwMH1cclxuICAgIH07XHJcblxyXG4gICAgaG91cjogbnVtYmVyO1xyXG4gICAgbWludXRlOiBudW1iZXI7XHJcbiAgICBzZWNvbmQ6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihob3VyOiBudW1iZXIsIG1pbnV0ZTogbnVtYmVyLCBzZWNvbmQ6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuaG91ciA9IGhvdXI7XHJcbiAgICAgICAgdGhpcy5taW51dGUgPSBtaW51dGU7XHJcbiAgICAgICAgdGhpcy5zZWNvbmQgPSBzZWNvbmQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcGFyc2VUaW1lcyh0aW1lczogc3RyaW5nW10pIHtcclxuICAgICAgICBsZXQgaG91ciwgbWludXRlLCBzZWNvbmQ7XHJcbiAgICAgICAgaWYgKHRpbWVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgaG91ciA9IHBhcnNlSW50KHRpbWVzWzBdLCAxMCk7XHJcbiAgICAgICAgICAgIG1pbnV0ZSA9IHBhcnNlSW50KHRpbWVzWzFdLCAxMCk7XHJcbiAgICAgICAgICAgIGlmIChUaW1lcGlja2VyVXRpbC5pc1JlYWxOdW1iZXIoaG91cikgJiYgVGltZXBpY2tlclV0aWwuaXNSZWFsTnVtYmVyKG1pbnV0ZSkpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aW1lcy5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kID0gcGFyc2VJbnQodGltZXNbMl0sIDEwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghVGltZXBpY2tlclV0aWwuaXNSZWFsTnVtYmVyKHNlY29uZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWNvbmQgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChob3VyIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhvdXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG1pbnV0ZSA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBtaW51dGUgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZCA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWNvbmQgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaG91ciAlPSAyNDtcclxuICAgICAgICAgICAgICAgIG1pbnV0ZSAlPSA2MDtcclxuICAgICAgICAgICAgICAgIHNlY29uZCAlPSA2MDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaG91ciA8IDEyICYmIHRpbWVzLmxlbmd0aCA+IDIgJiYgdGltZXNbMl0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygncG0nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhvdXIgKz0gMTI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IER1cmF0aW9uKGhvdXIsIG1pbnV0ZSwgc2Vjb25kKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgdmFsdWVPZihob3VyOiBudW1iZXIsIG1pbnV0ZTogbnVtYmVyLCBzZWNvbmQ6IG51bWJlcik6IER1cmF0aW9uIHtcclxuICAgICAgICByZXR1cm4gbmV3IER1cmF0aW9uKGhvdXIsIG1pbnV0ZSwgc2Vjb25kKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgemVybygpOiBEdXJhdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBEdXJhdGlvbigwLCAwLCAwKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZnJvbU1pbGxpcyhjb3VudDogbnVtYmVyKTogRHVyYXRpb24ge1xyXG4gICAgICAgIGlmIChjb3VudCA8IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgRHVyYXRpb24oXHJcbiAgICAgICAgICAgIE1hdGguZmxvb3IoY291bnQgLyBEdXJhdGlvbi5tYXRyaXguaG91cnMubWlsbGlzZWNvbmRzKSAlIER1cmF0aW9uLm1hdHJpeC5kYXlzLmhvdXJzLFxyXG4gICAgICAgICAgICBNYXRoLmZsb29yKGNvdW50IC8gRHVyYXRpb24ubWF0cml4Lm1pbnV0ZXMubWlsbGlzZWNvbmRzKSAlIER1cmF0aW9uLm1hdHJpeC5ob3Vycy5taW51dGVzLFxyXG4gICAgICAgICAgICBNYXRoLmZsb29yKGNvdW50IC8gRHVyYXRpb24ubWF0cml4LnNlY29uZHMubWlsbGlzZWNvbmRzKSAlIER1cmF0aW9uLm1hdHJpeC5taW51dGVzLnNlY29uZHNcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBmcm9tU3RyaW5nKHZhbHVlOiBzdHJpbmcsIHNlcGFyYXRvcj86IHN0cmluZyk6IER1cmF0aW9uIHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBsZXQgdGltZTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZXBhcmF0b3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB0aW1lID0gRHVyYXRpb24ucGFyc2VUaW1lcyh2YWx1ZS5zcGxpdChzZXBhcmF0b3IpKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGltZSA9IER1cmF0aW9uLnBhcnNlVGltZXModmFsdWUuc3BsaXQoJzonKSk7XHJcbiAgICAgICAgICAgIGlmICh0aW1lKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGltZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aW1lID0gRHVyYXRpb24ucGFyc2VUaW1lcyh2YWx1ZS5zcGxpdCgnLScpKTtcclxuICAgICAgICAgICAgaWYgKHRpbWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRpbWUgPSBEdXJhdGlvbi5wYXJzZVRpbWVzKHZhbHVlLnNwbGl0KCcuJykpO1xyXG4gICAgICAgICAgICBpZiAodGltZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRpbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGltZSA9IER1cmF0aW9uLnBhcnNlVGltZXModmFsdWUuc3BsaXQoJzsnKSk7XHJcbiAgICAgICAgICAgIGlmICh0aW1lKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGltZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aW1lID0gRHVyYXRpb24ucGFyc2VUaW1lcyh2YWx1ZS5zcGxpdCgnLCcpKTtcclxuICAgICAgICAgICAgaWYgKHRpbWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBmcm9tRGF0ZSh2YWx1ZTogRGF0ZSk6IER1cmF0aW9uIHtcclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRHVyYXRpb24odmFsdWUuZ2V0SG91cnMoKSwgdmFsdWUuZ2V0TWludXRlcygpLCB2YWx1ZS5nZXRTZWNvbmRzKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgbm93KHNlY29uZDogYm9vbGVhbiA9IHRydWUpOiBEdXJhdGlvbiB7XHJcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuICAgICAgICByZXR1cm4gbmV3IER1cmF0aW9uKG5vdy5nZXRIb3VycygpLCBub3cuZ2V0TWludXRlcygpLCBzZWNvbmQgPyBub3cuZ2V0U2Vjb25kcygpIDogMCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvbmUoKTogRHVyYXRpb24ge1xyXG4gICAgICAgIHJldHVybiBuZXcgRHVyYXRpb24odGhpcy5ob3VyLCB0aGlzLm1pbnV0ZSwgdGhpcy5zZWNvbmQpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZhbHVlKHR5cGU6IENsb2NrVHlwZSk6IG51bWJlciB7XHJcbiAgICAgICAgaWYgKFsnaG91cicsICdtaW51dGUnLCAnc2Vjb25kJ10uaW5jbHVkZXModHlwZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXNbdHlwZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFZhbHVlKHR5cGU6IENsb2NrVHlwZSwgdmFsdWU6IG51bWJlcikge1xyXG4gICAgICAgIGlmIChbJ2hvdXInLCAnbWludXRlJywgJ3NlY29uZCddLmluY2x1ZGVzKHR5cGUpKSB7XHJcbiAgICAgICAgICAgIHRoaXNbdHlwZV0gPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TmV3KHR5cGU6IENsb2NrVHlwZSwgdmFsdWU6IG51bWJlcik6IER1cmF0aW9uIHtcclxuICAgICAgICBjb25zdCByZXN1bHQ6IER1cmF0aW9uID0gbmV3IER1cmF0aW9uKHRoaXMuaG91ciwgdGhpcy5taW51dGUsIHRoaXMuc2Vjb25kKTtcclxuICAgICAgICBpZiAoWydob3VyJywgJ21pbnV0ZScsICdzZWNvbmQnXS5pbmNsdWRlcyh0eXBlKSkge1xyXG4gICAgICAgICAgICByZXN1bHRbdHlwZV0gPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXQoZm9ybWF0Pzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAoZm9ybWF0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcGxhY2UgPSAoZiwgdiwgcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG1hdGNoO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHIubWF0Y2goZik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoICYmIHR5cGVvZiBtYXRjaFswXSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgciA9IHIucmVwbGFjZShtYXRjaFswXSwgU3RyaW5nKHYpLnBhZFN0YXJ0KG1hdGNoWzBdLmxlbmd0aCwgJzAnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHI7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBmb3JtYXQ7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlcGxhY2UoL2grL2ksIHRoaXMuaG91ciwgcmVzdWx0KTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gcmVwbGFjZSgvbSsvaSwgdGhpcy5taW51dGUsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlcGxhY2UoL3MrL2ksIHRoaXMuc2Vjb25kLCByZXN1bHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgJHtTdHJpbmcodGhpcy5ob3VyKS5wYWRTdGFydCgyLCAnMCcpfToke1N0cmluZyh0aGlzLm1pbnV0ZSkucGFkU3RhcnQoMiwgJzAnKX06JHtTdHJpbmcodGhpcy5zZWNvbmQpLnBhZFN0YXJ0KDIsICcwJyl9YDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbWlsbGlzZWNvbmRzKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaG91ciAqIER1cmF0aW9uLm1hdHJpeC5ob3Vycy5taWxsaXNlY29uZHMgK1xyXG4gICAgICAgICAgICB0aGlzLm1pbnV0ZSAqIER1cmF0aW9uLm1hdHJpeC5taW51dGVzLm1pbGxpc2Vjb25kcyArXHJcbiAgICAgICAgICAgIHRoaXMuc2Vjb25kICogRHVyYXRpb24ubWF0cml4LnNlY29uZHMubWlsbGlzZWNvbmRzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFRvRGF0ZSh2YWx1ZTogRGF0ZSk6IERhdGUge1xyXG4gICAgICAgIHZhbHVlLnNldEhvdXJzKHRoaXMuaG91cik7XHJcbiAgICAgICAgdmFsdWUuc2V0TWludXRlcyh0aGlzLm1pbnV0ZSk7XHJcbiAgICAgICAgdmFsdWUuc2V0U2Vjb25kcyh0aGlzLnNlY29uZCk7XHJcbiAgICAgICAgdmFsdWUuc2V0TWlsbGlzZWNvbmRzKDApO1xyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBlcXVhbHModmFsdWU6IER1cmF0aW9uKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgdGhpcy5ob3VyID09PSB2YWx1ZS5ob3VyICYmIHRoaXMubWludXRlID09PSB2YWx1ZS5taW51dGUgJiYgdGhpcy5zZWNvbmQgPT09IHZhbHVlLnNlY29uZDtcclxuICAgIH1cclxufVxyXG4iXX0=